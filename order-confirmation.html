<!DOCTYPE html>
<html lang="en">
<head>


<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<!-- Tailwind -->
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>

<!-- Tailwind Config -->
<script>
tailwind.config = {
    darkMode: "class",
    theme: {
        extend: {
            colors: {
                "primary": "#137fec",
                "accent-gold": "#d4af37",
                "background-light": "#f6f7f8",
                "background-dark": "#101922",
            },
            fontFamily: {
                "display": ["Inter", "sans-serif"]
            }
        }
    }
}
</script>




  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Order Confirmation - Hitaishi Lens</title>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;background:#f7f8fb;color:#222;margin:0;padding:20px}
    .container{max-width:900px;margin:160px auto 60px;padding:20px}
    .card{background:#fff;padding:24px;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,0.06)}
    h1{font-size:24px;margin-bottom:6px}
    .muted{color:#666;font-size:14px}
    .items{margin-top:18px}
    .item{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid #eee}
    .actions{margin-top:20px;display:flex;gap:12px}
    .btn{padding:10px 16px;border-radius:8px;text-decoration:none;color:#fff;background:#667eea;display:inline-block}
    .btn.secondary{background:#6b7280}
  </style>
</head>
<body>
  <div id="navbar-root"></div>

  <div class="container">
    <div class="card">
      <div id="status">
        <h1>Order Confirmation</h1>
        <div id="summary" class="muted">Loading order details…</div>
      </div>

      <div id="orderDetails" style="display:none">
        <div style="margin-top:12px"><strong>Order ID:</strong> <span id="orderId"></span></div>
        <div style="margin-top:6px" id="customerInfo" class="muted"></div>

        <div class="items" id="itemsList"></div>

        <div style="margin-top:12px" id="totals" class="muted"></div>

        <div class="actions">
          <a href="index.html" class="btn">Back to Home</a>
          <a href="trackorder.html" class="btn secondary">Track Orders</a>
        </div>
      </div>
    </div>
  </div>

  <div id="footer"></div>

  <script>
    // Load navbar (same approach used on index.html)
    (async function loadNavbar(){
      try{
        const res = await fetch('navbar.html');
        const text = await res.text();
        const container = document.createElement('div'); container.innerHTML = text;
        const parts = ['.desktop-nav', '.mobile-nav', '.mobile-menu', '#overlay'];
        const root = document.getElementById('navbar-root');
        parts.forEach(sel => { const el = container.querySelector(sel); if (el) root.appendChild(el); });

        const scripts = Array.from(container.querySelectorAll('script'));
        scripts.forEach(s => { const ns = document.createElement('script'); if (s.src){ ns.src = s.src; ns.async = false; document.head.appendChild(ns); } else { ns.textContent = s.textContent; document.head.appendChild(ns); } });

        // small delay to allow navbar init functions to be available
        setTimeout(() => { try{ if (window.updateAuthAndCart) window.updateAuthAndCart(); }catch(e){} }, 40);
      }catch(e){ console.warn('Navbar load failed', e); }
    })();

    // Load footer
    fetch('footer.html').then(r=>r.text()).then(t=>document.getElementById('footer').innerHTML = t).catch(()=>{});

    function getQueryParam(name){ const params = new URLSearchParams(window.location.search); return params.get(name); }

    async function loadOrder(){
      const id = getQueryParam('orderId');
      const summaryEl = document.getElementById('summary');
      if (!id){ summaryEl.textContent = 'No order id provided.'; return; }
      document.getElementById('orderId').textContent = id;

      try{
        const resp = await fetch('https://opticscart.com/api/orders/' + encodeURIComponent(id));
        const data = await resp.json();
        if (!resp.ok || !data.success){ summaryEl.textContent = data.error || 'Unable to load order.'; return; }

        // show details
        document.getElementById('orderDetails').style.display = 'block';
        summaryEl.style.display = 'none';

        const order = data.order || {};
        const items = data.items || [];

        document.getElementById('customerInfo').textContent = (order.customer_name ? order.customer_name + ' · ' : '') + (order.email || '') + (order.phone ? ' · ' + order.phone : '');

        const itemsList = document.getElementById('itemsList');
        itemsList.innerHTML = items.map(it => `\n          <div class="item">\n            <div>\n              <div style="font-weight:600">${escapeHtml(it.name || 'Product')}</div>\n              <div class="muted">Qty: ${it.quantity} · ₹${parseFloat(it.price||0).toFixed(2)}</div>\n            </div>\n            <div style="font-weight:700">₹${parseFloat(it.subtotal||0).toFixed(2)}</div>\n          </div>\n        `).join('');

        document.getElementById('totals').textContent = 'Total: ₹' + (parseFloat(order.total_amount||0).toFixed(2));
      }catch(err){ summaryEl.textContent = 'Network error loading order.'; console.error(err); }
    }

    function escapeHtml(str){ return String(str||'').replace(/[&<>"']/g, s=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;" })[s]); }

    loadOrder();
  </script>
</body>
</html>
