<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Product Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f8f9fa;
            color: #333;
        }

        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar h1 {
            font-size: 24px;
        }

        .navbar-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .navbar a, .navbar button {
            background: white;
            color: #667eea;
            padding: 10px 20px;
            border-radius: 5px;
            text-decoration: none;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .navbar a:hover, .navbar button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h2 {
            font-size: 28px;
            color: #333;
        }

        .btn-primary {
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border-radius: 5px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .search-bar {
            margin-bottom: 25px;
            display: flex;
            gap: 10px;
        }

        .search-bar input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .search-bar input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-bar button {
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .search-bar button:hover {
            background: #764ba2;
        }

        .products-table {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 1200px;
        }

        thead {
            background: #f5f5f5;
            border-bottom: 2px solid #e0e0e0;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #667eea;
            font-size: 13px;
            text-transform: uppercase;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        tbody tr:hover {
            background: #f9f9f9;
        }

        .product-image {
            width: 50px;
            height: 50px;
            border-radius: 5px;
            object-fit: cover;
            background: #f0f0f0;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-type {
            background: #e3f2fd;
            color: #1976d2;
        }

        .badge-stock {
            background: #c8e6c9;
            color: #2e7d32;
        }

        .badge-stock.low {
            background: #ffccbc;
            color: #d84315;
        }

        .action-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            min-width: 250px;
        }

        .btn-edit, .btn-delete, .btn-view {
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 700;
            font-size: 13px;
            transition: all 0.3s;
            white-space: nowrap;
            flex: 1;
            min-width: 70px;
            text-align: center;
        }

        .btn-edit {
            background: #667eea;
            color: white;
        }

        .btn-edit:hover {
            background: #764ba2;
        }

        .btn-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-delete:hover {
            background: #c0392b;
        }

        .btn-view {
            background: #27ae60;
            color: white;
        }

        .btn-view:hover {
            background: #229954;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }

        .empty-state p {
            color: #666;
            font-size: 16px;
            margin-bottom: 20px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 8px;
            font-size: 13px;
            text-transform: uppercase;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 5px;
            font-family: inherit;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .image-preview {
            width: 100%;
            max-width: 200px;
            height: 150px;
            border-radius: 5px;
            object-fit: cover;
            margin-top: 10px;
            border: 2px solid #e0e0e0;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #f0f0f0;
        }

        .btn-cancel {
            background: #e0e0e0;
            color: #333;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-cancel:hover {
            background: #d0d0d0;
        }

        .btn-save {
            background: #667eea;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-save:hover {
            background: #764ba2;
        }

        /* Alert/Message styles */
        .alert {
            padding: 15px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.active {
            display: block;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Confirmation Modal */
        .confirm-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }

        .confirm-modal.active {
            display: flex;
        }

        .confirm-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .confirm-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #333;
        }

        .confirm-message {
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .confirm-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .btn-confirm-delete {
            background: #e74c3c;
            color: white;
        }

        .btn-confirm-delete:hover {
            background: #c0392b;
        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 15px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .search-bar {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="navbar">
        <h1>üï∂Ô∏è Hitaishi Lens - Admin</h1>
        <div class="navbar-right">
            <a href="products.html">View Store</a>
            <a href="admin-orders.html">Orders</a>
            <button onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h2>Product Management</h2>
            <button class="btn-primary" onclick="openAddModal()">+ Add New Product</button>
        </div>

        <div class="alert alert-success" id="successAlert"></div>
        <div class="alert alert-error" id="errorAlert"></div>

        <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search by name, brand, or type...">
            <button onclick="searchProducts()">Search</button>
            <button onclick="resetSearch()" style="background: #999;">Reset</button>
        </div>

        <div class="products-table">
            <div class="loading" id="loadingState">
                <div class="loading-spinner"></div>
                <p>Loading products...</p>
            </div>
            <table id="productsTable" style="display: none;">
                <thead>
                    <tr>
                        <th>Image</th>
                        <th>Name</th>
                        <th>Brand</th>
                        <th>Type</th>
                        <th>Price</th>
                        <th>Power Range</th>
                        <th>Color</th>
                        <th>Frame Material</th>
                        <th>Coating Type</th>
                        <th>Collection</th>
                        <th>Gender</th>
                        <th>Category</th>
                        <th>Stock</th>
                        <th>Added On</th>
                        <th>Updated On</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="productsBody">
                </tbody>
            </table>
            <div class="empty-state" id="emptyState" style="display: none;">
                <p>No products found</p>
            </div>
        </div>
    </div>

    <!-- Edit/Add Product Modal -->
    <div class="modal" id="productModal">
        <div class="modal-content">
            <div class="modal-header">
                <span id="modalTitle">Add New Product</span>
                <button class="close-btn" onclick="closeProductModal()">&times;</button>
            </div>
            <form id="productForm" onsubmit="saveProduct(event)">
                <div class="form-group">
                    <label>Product Name *</label>
                    <input type="text" id="productName" required>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Brand *</label>
                        <input type="text" id="productBrand" required>
                    </div>
                    <div class="form-group">
                        <label>Type *</label>
                        <input type="text" id="productType" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Price (‚Çπ) *</label>
                        <input type="number" id="productPrice" step="0.01" required>
                    </div>
                    <div class="form-group">
                        <label>Stock</label>
                        <input type="number" id="productStock" value="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Gender Category *</label>
                        <select id="productGenderCategory" required>
                            <option value="">Select Gender</option>
                            <option value="Men">Men</option>
                            <option value="Women">Women</option>
                            <option value="Children">Children</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Product Category *</label>
                        <select id="productProductCategory" required>
                            <option value="">Select Category</option>
                            <option value="Eye Glasses">Eye Glasses</option>
                            <option value="Sunglasses">Sunglasses</option>
                            <option value="Contact Lenses">Contact Lenses</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Collection</label>
                        <input type="text" id="productCollection" placeholder="e.g., Premium, Classic">
                    </div>
                    <div class="form-group">
                        <label>Power Range</label>
                        <input type="text" id="productPowerRange" placeholder="e.g., -6.0 to +8.0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Frame Material</label>
                        <input type="text" id="productFrameMaterial" placeholder="e.g., Metal, Plastic">
                    </div>
                    <div class="form-group">
                        <label>Coating Type</label>
                        <input type="text" id="productCoatingType" placeholder="e.g., Anti-glare, UV Protection">
                    </div>
                </div>

                <div class="form-group">
                    <label>Color</label>
                    <input type="text" id="productColor" placeholder="e.g., Brown, Clear">
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea id="productDescription" placeholder="Product description..."></textarea>
                </div>

                <div class="form-group">
                    <label>Product Image</label>
                    <input type="file" id="productImage" accept="image/*">
                    <img id="imagePreview" class="image-preview" style="display: none;">
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn-cancel" onclick="closeProductModal()">Cancel</button>
                    <button type="submit" class="btn-save">Save Product</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="confirm-modal" id="confirmModal">
        <div class="confirm-content">
            <div class="confirm-title">Confirm Delete</div>
            <div class="confirm-message">Are you sure you want to delete this product? This action cannot be undone.</div>
            <div class="confirm-actions">
                <button class="btn-cancel" onclick="closeConfirmModal()">Cancel</button>
                <button class="btn-cancel btn-confirm-delete" onclick="confirmDelete()">Delete</button>
            </div>
        </div>
    </div>

    <script>
        let allProducts = [];
        let currentEditingId = null;
        let deleteProductId = null;

        // Load products on page load
        async function loadProducts() {
            try {
                const response = await fetch('http://localhost:5000/api/get-lens');
                const data = await response.json();

                if (data.success && Array.isArray(data.products)) {
                    allProducts = data.products;
                    displayProducts(allProducts);
                } else {
                    showEmpty();
                }
            } catch (error) {
                console.error('Error loading products:', error);
                showEmpty();
                showError('Failed to load products');
            }
        }

        function displayProducts(products) {
            const table = document.getElementById('productsTable');
            const tbody = document.getElementById('productsBody');
            const emptyState = document.getElementById('emptyState');
            const loadingState = document.getElementById('loadingState');

            if (products.length === 0) {
                table.style.display = 'none';
                emptyState.style.display = 'block';
                loadingState.style.display = 'none';
                return;
            }

            tbody.innerHTML = products.map(product => `
                <tr>
                    <td>
                        ${product.image_url ? 
                            `<img src="http://localhost:5000${product.image_url}" alt="${product.name}" class="product-image" onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 width=%2250%22 height=%2250%22%3E%3Crect fill=%22%23ccc%22 width=%2250%22 height=%2250%22/%3E%3C/svg%3E'">` 
                            : '<div class="product-image" style="display: flex; align-items: center; justify-content: center; background: #f0f0f0;">N/A</div>'
                        }
                    </td>
                    <td><strong>${product.name}</strong></td>
                    <td>${product.brand}</td>
                    <td><span class="badge badge-type">${product.type}</span></td>
                    <td><strong>‚Çπ${parseFloat(product.price).toLocaleString('en-IN', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</strong></td>
                    <td>${product.power_range || '-'}</td>
                    <td>${product.color || '-'}</td>
                    <td>${product.frame_material || '-'}</td>
                    <td>${product.coating_type || '-'}</td>
                    <td>${product.collection || '-'}</td>
                    <td>${product.gender_category || '-'}</td>
                    <td>${product.product_category || '-'}</td>
                    <td>
                        <span class="badge badge-stock ${product.stock < 10 ? 'low' : ''}">
                            ${product.stock}
                        </span>
                    </td>
                    <td>${new Date(product.created_at).toLocaleDateString('en-IN')}</td>
                    <td>${product.updated_at ? new Date(product.updated_at).toLocaleDateString('en-IN') : '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn-view" onclick="viewProduct(${product.id})">View</button>
                            <button class="btn-edit" onclick="openEditModal(${product.id})">Edit</button>
                            <button class="btn-delete" onclick="deleteProduct(${product.id})">Delete</button>
                        </div>
                    </td>
                </tr>
            `).join('');

            table.style.display = 'table';
            emptyState.style.display = 'none';
            loadingState.style.display = 'none';
        }

        function showEmpty() {
            document.getElementById('productsTable').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
            document.getElementById('loadingState').style.display = 'none';
        }

        function openAddModal() {
            currentEditingId = null;
            document.getElementById('modalTitle').innerText = 'Add New Product';
            document.getElementById('productForm').reset();
            document.getElementById('imagePreview').style.display = 'none';
            document.getElementById('productModal').classList.add('active');
        }

        function openEditModal(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;

            currentEditingId = id;
            document.getElementById('modalTitle').innerText = 'Edit Product';
            document.getElementById('productName').value = product.name;
            document.getElementById('productBrand').value = product.brand;
            document.getElementById('productType').value = product.type;
            document.getElementById('productPrice').value = product.price;
            document.getElementById('productStock').value = product.stock;
            document.getElementById('productGenderCategory').value = product.gender_category || '';
            document.getElementById('productProductCategory').value = product.product_category || '';
            document.getElementById('productCollection').value = product.collection || '';
            document.getElementById('productPowerRange').value = product.power_range || '';
            document.getElementById('productFrameMaterial').value = product.frame_material || '';
            document.getElementById('productCoatingType').value = product.coating_type || '';
            document.getElementById('productColor').value = product.color || '';
            document.getElementById('productDescription').value = product.description || '';

            if (product.image_url) {
                const preview = document.getElementById('imagePreview');
                preview.src = `http://localhost:5000${product.image_url}`;
                preview.style.display = 'block';
            }

            document.getElementById('productModal').classList.add('active');
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
            currentEditingId = null;
        }

        async function saveProduct(e) {
            e.preventDefault();

            const formData = new FormData();
            formData.append('name', document.getElementById('productName').value);
            formData.append('brand', document.getElementById('productBrand').value);
            formData.append('type', document.getElementById('productType').value);
            formData.append('price', document.getElementById('productPrice').value);
            formData.append('stock', document.getElementById('productStock').value);
            formData.append('gender_category', document.getElementById('productGenderCategory').value);
            formData.append('product_category', document.getElementById('productProductCategory').value);
            formData.append('collection', document.getElementById('productCollection').value);
            formData.append('power_range', document.getElementById('productPowerRange').value);
            formData.append('frame_material', document.getElementById('productFrameMaterial').value);
            formData.append('coating_type', document.getElementById('productCoatingType').value);
            formData.append('color', document.getElementById('productColor').value);
            formData.append('description', document.getElementById('productDescription').value);

            const imageFile = document.getElementById('productImage').files[0];
            if (imageFile) {
                formData.append('image', imageFile);
            }

            try {
                const url = currentEditingId 
                    ? `http://localhost:5000/api/update-lens/${currentEditingId}`
                    : 'http://localhost:5000/api/upload-lens';
                
                const method = currentEditingId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    body: formData
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess(currentEditingId ? 'Product updated successfully' : 'Product added successfully');
                    closeProductModal();
                    loadProducts();
                } else {
                    showError(data.error || 'Failed to save product');
                }
            } catch (error) {
                console.error('Error saving product:', error);
                showError('Failed to save product');
            }
        }

        function viewProduct(id) {
            const product = allProducts.find(p => p.id === id);
            if (!product) return;

            const viewModal = document.createElement('div');
            viewModal.id = 'viewProductModal';
            viewModal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center; z-index: 1000;';
            
            viewModal.innerHTML = `
                <div style="background: white; border-radius: 8px; padding: 30px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #007bff; padding-bottom: 10px;">
                        <h3 style="margin: 0; color: #333;">Product Details</h3>
                        <button onclick="document.getElementById('viewProductModal').remove();" style="background: none; border: none; font-size: 24px; cursor: pointer; color: #999;">&times;</button>
                    </div>
                    
                    ${product.image_url ? `<div style="text-align: center; margin-bottom: 20px;"><img src="http://localhost:5000${product.image_url}" style="max-width: 100%; max-height: 200px; border-radius: 4px;"></div>` : ''}
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; font-size: 14px; line-height: 1.8;">
                        <div><strong>Product ID:</strong> ${product.id}</div>
                        <div><strong>Name:</strong> ${product.name}</div>
                        <div><strong>Brand:</strong> ${product.brand}</div>
                        <div><strong>Type:</strong> ${product.type}</div>
                        <div><strong>Price:</strong> ‚Çπ${parseFloat(product.price).toLocaleString('en-IN')}</div>
                        <div><strong>Stock:</strong> ${product.stock}</div>
                        <div><strong>Power Range:</strong> ${product.power_range || '-'}</div>
                        <div><strong>Color:</strong> ${product.color || '-'}</div>
                        <div><strong>Frame Material:</strong> ${product.frame_material || '-'}</div>
                        <div><strong>Coating Type:</strong> ${product.coating_type || '-'}</div>
                        <div><strong>Collection:</strong> ${product.collection || '-'}</div>
                        <div><strong>Gender Category:</strong> ${product.gender_category || '-'}</div>
                        <div><strong>Product Category:</strong> ${product.product_category || '-'}</div>
                        <div style="grid-column: 1/-1;"><strong>Description:</strong> ${product.description || '-'}</div>
                        <div><strong>Added On:</strong> ${new Date(product.created_at).toLocaleDateString('en-IN')}</div>
                        <div><strong>Updated On:</strong> ${product.updated_at ? new Date(product.updated_at).toLocaleDateString('en-IN') : '-'}</div>
                    </div>
                    
                    <div style="margin-top: 20px; text-align: right; border-top: 1px solid #eee; padding-top: 15px;">
                        <button onclick="openEditModal(${product.id})" style="background: #007bff; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer; margin-right: 10px;">Edit</button>
                        <button onclick="document.getElementById('viewProductModal').remove();" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">Close</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(viewModal);
            viewModal.onclick = (e) => {
                if (e.target.id === 'viewProductModal') viewModal.remove();
            };
        }

        function deleteProduct(id) {
            deleteProductId = id;
            document.getElementById('confirmModal').classList.add('active');
        }

        function closeConfirmModal() {
            document.getElementById('confirmModal').classList.remove('active');
            deleteProductId = null;
        }

        async function confirmDelete() {
            if (!deleteProductId) return;

            try {
                const response = await fetch(`http://localhost:5000/api/delete-lens/${deleteProductId}`, {
                    method: 'DELETE'
                });

                const data = await response.json();

                if (data.success) {
                    showSuccess('Product deleted successfully');
                    closeConfirmModal();
                    loadProducts();
                } else {
                    showError(data.error || 'Failed to delete product');
                }
            } catch (error) {
                console.error('Error deleting product:', error);
                showError('Failed to delete product');
            }
        }

        function searchProducts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (!searchTerm) {
                displayProducts(allProducts);
                return;
            }

            const filtered = allProducts.filter(product =>
                product.name.toLowerCase().includes(searchTerm) ||
                product.brand.toLowerCase().includes(searchTerm) ||
                product.type.toLowerCase().includes(searchTerm)
            );

            displayProducts(filtered);
        }

        function resetSearch() {
            document.getElementById('searchInput').value = '';
            displayProducts(allProducts);
        }

        function showSuccess(message) {
            const alert = document.getElementById('successAlert');
            alert.innerText = message;
            alert.classList.add('active');
            setTimeout(() => alert.classList.remove('active'), 3000);
        }

        function showError(message) {
            const alert = document.getElementById('errorAlert');
            alert.innerText = message;
            alert.classList.add('active');
            setTimeout(() => alert.classList.remove('active'), 3000);
        }

        function logout() {
            localStorage.removeItem('adminToken');
            window.location.href = 'login.html';
        }

        // Handle image preview
        document.getElementById('productImage')?.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('imagePreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        });

        // Close modal when clicking outside
        document.getElementById('productModal').addEventListener('click', function(e) {
            if (e.target === this) closeProductModal();
        });

        // Load products on page load
        loadProducts();
    </script>
</body>
</html>
